<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>Liberty Bookkeeping Trainer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <link rel="stylesheet" href="style.css" />
  
  <script src="https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/dist/kuromoji.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/kuroshiro@1.2.0/dist/kuroshiro.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/kuroshiro-analyzer-kuromoji@1.1.0/dist/kuroshiro-analyzer-kuromoji.min.js"></script>

  <script src="config.js"></script>
  <!-- ⭐ Supabase を「外で」読み込む（ここがポイント） -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <script src="app.js"></script>
</head>
<body>
  <div class="page">
    <header>
      <!-- Liberty ロゴ -->
      <img src="https://liberty-system.co.jp/common/img/logo.png" alt="Liberty" class="logo" />
      <div class="title-block">
        <h1 data-i18n="app-title">Liberty Bookkeeping Trainer</h1>
        <span data-i18n="app-subtitle">留学生向け 簿記仕訳トレーニング 2.0</span>
      </div>

     <div class="auth-box">
      <!-- ログアウト状態 -->
      <div id="auth-when-logged-out">
       <div class="auth-fields">
        <input type="email" id="auth-email" placeholder="メールアドレス" />
        <input type="password" id="auth-password" placeholder="パスワード" />
       </div>

      <div class="auth-actions">
        <button class="auth-primary-btn" id="btn-login">ログイン</button>
        <a href="signup.html" class="auth-link">新規登録</a>
        <a href="forgot-password.html" class="auth-link">パスワードをお忘れの方はこちら</a>
       </div>
      </div>

  <!-- ログイン状態 -->
  <div id="auth-when-logged-in" style="display:none;">
    <span id="auth-user-label" class="auth-status"></span>
    <button class="auth-small-btn" id="btn-logout">ログアウト</button>
  </div>
</div>


    <!-- 動画・スライド / 履歴ページへのボタン -->
    <div class="top-nav">
      <a href="contents.html">
        <button class="top-nav-btn">
          <span class="icon">🎥</span>
          <span>動画・スライドを見る</span>
        </button>
      </a>
      <a href="history.html">
        <button class="top-nav-btn">
          <span class="icon">📊</span>
          <span>学習履歴ページへ</span>
        </button>
      </a>
      <a href="analytics.html">
        <button class="top-nav-btn">
          <span class="icon">📈</span>
          <span>学習分析</span>
        </button>
      </a>
    </div>

    <div class="layout">
      <!-- 左：問題＆入力 -->
      <section class="card">
        <div class="card-header">
          <div class="card-title">
            <span class="card-title-pill" data-i18n="practice-pill">Practice</span>
            <span id="question-label">問題 0 / 0</span>
          </div>
          <div class="lang-toggle">
            <button id="lang-ja" class="active">日本語</button>
            <button id="lang-en">English</button>
          </div>

          <!-- ルビ表示切替ボタン -->
          <button id="toggle-ruby" class="auth-small-btn" style="margin-left:8px;">
            ルビ表示：OFF
          </button>

          <button id="btn-landscape" class="auth-small-btn" style="margin-left:8px;">
            横画面モード
          </button>
          
        </div>

        <!-- 出題条件 -->
        <div class="filter-row">
          <span data-i18n="filter-category">カテゴリ:</span>
          <select id="category-filter"></select>
          <span data-i18n="filter-count">問題数:</span>
          <select id="question-count"></select>
          <label>
            <input type="checkbox" id="filter-unlearned" />
            <span data-i18n="filter-unlearned">未学習のみ</span>
          </label>
          <label>
            <input type="checkbox" id="filter-not-cleared" />
            <span data-i18n="filter-not-cleared">未修得のみ</span>
          </label>
          <label>
            <input type="checkbox" id="mode-drill" />
            <span data-i18n="filter-drill">特訓モード</span>
          </label>
          <button id="btn-start-session" data-i18n="filter-start">出題開始</button>
        </div>

        <div class="question-meta">
          <span class="badge" id="category-label"></span>
          <span id="id-label"></span>
          <span id="random-label"></span>
        </div>

        <div class="question-text" id="question-text-ja">
          <!-- 日本語問題文 -->
        </div>
        <div class="question-text" id="question-text-en" style="display:none;">
          <!-- English question -->
        </div>

        <div class="toggle-row">
          <span data-i18n="toggle-main">借方・貸方の科目と金額を入力してください。</span>
          <label>
            <input type="checkbox" id="random-mode" />
            <span data-i18n="toggle-random">ランダム出題</span>
          </label>
        </div>

        <p class="hint-text" id="hint-text" data-i18n="hint-text" data-furigana-target>
          行ごとに「借方勘定科目・金額」「貸方勘定科目・金額」を入力します。<br>
          不要な欄は科目を「空欄」のまま、金額も空欄にしておいてください。
        </p>

        <!-- 仕訳入力テーブル -->
        <div class="entry-table">
          <div class="entry-header-row">
            <span data-i18n="entry-col-row">行</span>
            <span data-i18n="entry-col-debit">借方勘定科目</span>
            <span data-i18n="entry-col-debit-amount">金額</span>
            <span data-i18n="entry-col-credit">貸方勘定科目</span>
            <span data-i18n="entry-col-credit-amount">金額</span>
          </div>

          <!-- 4行分用意 -->
          <div class="entry-row">
            <span class="row-label">1</span>
            <select class="account-select" id="debit-account-1"></select>
            <input type="text" id="debit-amount-1" class="amount-input" inputmode="numeric" autocomplete="off" />
            <select class="account-select" id="credit-account-1"></select>
            <input type="text" id="credit-amount-1" class="amount-input" inputmode="numeric" autocomplete="off" />
          </div>

          <div class="entry-row">
            <span class="row-label">2</span>
            <select class="account-select" id="debit-account-2"></select>
            <input type="text" id="debit-amount-2" class="amount-input" inputmode="numeric" autocomplete="off" />
            <select class="account-select" id="credit-account-2"></select>
            <input type="text" id="credit-amount-2" class="amount-input" inputmode="numeric" autocomplete="off" />
          </div>

          <div class="entry-row">
            <span class="row-label">3</span>
            <select class="account-select" id="debit-account-3"></select>
            <input type="text" id="debit-amount-3" class="amount-input" inputmode="numeric" autocomplete="off" />
            <select class="account-select" id="credit-account-3"></select>
            <input type="text" id="credit-amount-3" class="amount-input" inputmode="numeric" autocomplete="off" />
          </div>

          <div class="entry-row">
            <span class="row-label">4</span>
            <select class="account-select" id="debit-account-4"></select>
            <input type="text" id="debit-amount-4" class="amount-input" inputmode="numeric" autocomplete="off" />
            <select class="account-select" id="credit-account-4"></select>
            <input type="text" id="credit-amount-4" class="amount-input" inputmode="numeric" autocomplete="off" />
          </div>
        </div>

        <div class="button-row">
          <button id="prev-question" class="btn btn-secondary" data-i18n="btn-prev">⏮ 前の問題へ</button>
          <button id="check-answer" class="btn btn-primary" data-i18n="btn-check">✔ 答え合わせ</button>
          <button id="next-question" class="btn btn-outline" data-i18n="btn-next">⏭ 次の問題へ</button>
        </div>

        <div id="result-message" class="result-message"></div>

        <div class="answer-panel" id="answer-panel" style="display:none;">
          <h3 data-i18n="answer-title">模範仕訳 / Model Answer</h3>
          <pre id="answer-ja"></pre>
          <pre id="answer-en"></pre>
          <div id="answer-ref-links" style="margin-bottom:8px; font-size:0.9rem;"></div>
          <small data-i18n="answer-note">※ 科目名と金額が合致していれば正解です（行の順番は問いません）。</small>
        </div>
      </section>

      <!-- 右：進捗＆履歴 -->
      <aside class="card">
        <div class="side-card-title" data-i18n="progress-title">進捗 / Progress</div>
        <div class="score-box">
          <div class="score-pill" id="score-pill">正解 0 / 0</div>
        </div>

        <!-- AI解説（右サイドに追加） -->
 <div style="margin-top:14px;">
  <div class="side-card-title" data-i18n="ai-explain-title">AI解説（この問題）</div>

  <div id="ai-chat-box" style="
    border:1px solid var(--border-soft);
    border-radius:10px;
    padding:8px;
    background:#f9fbff;
    font-size:0.78rem;
    max-height:440px;
    overflow-y:auto;
  "></div>

  <div style="display:flex; gap:6px; margin-top:8px;">
    <button id="btn-ai-explain" class="btn btn-primary" style="flex:1;" data-i18n="btn-ai-explain">
      この問題を解説して
    </button>
    <button id="btn-ai-clear" class="btn btn-secondary" style="flex:0;" data-i18n="btn-ai-clear">
      クリア
    </button>
  </div>
 
  <div style="margin-top:6px; font-size:0.72rem; color:var(--text-muted); line-height:1.4;" data-i18n="ai-note">
    ※AIの解説は学習補助です。最終判断はテキスト等で確認してください。
  </div>
</div>

        
        <p id="progress-help"
          data-i18n="progress-help"
          style="font-size:0.8rem; color:var(--text-muted); margin-top:0;">
          ・「出題開始」で選択した条件の問題セットを開始します。<br>
          ・「答え合わせ」で自動判定します。<br>
          ・ランダム出題をONにすると、順番をシャッフルします。<br>
          ・日本語 / 英語はいつでも切り替え可能です。
        </p>

        <div class="history-box-title" data-i18n="history-title">直近の学習履歴</div>
        <div id="history-list" class="history-list">
          <!-- 履歴が入る -->
        </div>
      </aside>
    </div>

    <footer>
      &copy; Liberty Co., Ltd. Bookkeeping Trainer 2.0
    </footer>
  </div>
</body>
</html>
